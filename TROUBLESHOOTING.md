# æ‰“åŒ…åé—®é¢˜æ’æŸ¥æŒ‡å—

## é—®é¢˜ï¼šæµè§ˆå™¨å‘é€æ¶ˆæ¯åï¼ŒElectron å®¢æˆ·ç«¯æ²¡ååº”

### æ’æŸ¥æ­¥éª¤

#### 1. æ£€æŸ¥ WebSocket æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨

**æ–¹æ³•ä¸€ï¼šæŸ¥çœ‹ Electron æ§åˆ¶å°**
- æ‰“å¼€ Electron åº”ç”¨
- æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œåº”è¯¥çœ‹åˆ°ï¼š
  ```
  âœ… WebSocket æœåŠ¡å™¨å·²å¯åŠ¨: ws://127.0.0.1:8765/ws
  âœ… å¥åº·æ£€æŸ¥: http://127.0.0.1:8765/health
  ```

**æ–¹æ³•äºŒï¼šæµè§ˆå™¨æµ‹è¯•**
åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
fetch('http://127.0.0.1:8765/health')
  .then(r => r.json())
  .then(console.log)
```

å¦‚æœè¿”å› `{ status: 'ok', port: 8765 }` è¯´æ˜æœåŠ¡å™¨æ­£å¸¸ã€‚

#### 2. æ£€æŸ¥ preload.js æ˜¯å¦æ­£ç¡®åŠ è½½

**æŸ¥çœ‹ Electron æ§åˆ¶å°**
åº”è¯¥çœ‹åˆ°ï¼š
```
ğŸ“ Preload è·¯å¾„: ...
ğŸ“ __dirname: ...
ğŸ“¦ æ˜¯å¦æ‰“åŒ…: true/false
```

å¦‚æœ preload è·¯å¾„é”™è¯¯ï¼Œä¼šçœ‹åˆ°é”™è¯¯ä¿¡æ¯ã€‚

#### 3. æ£€æŸ¥æ¶ˆæ¯æ¥æ”¶

**æŸ¥çœ‹ Electron æ§åˆ¶å°**
å½“æµè§ˆå™¨å‘é€æ¶ˆæ¯æ—¶ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
ğŸ“¨ æ”¶åˆ°æµè§ˆå™¨æ¶ˆæ¯: ...
ğŸ“¨ æ¶ˆæ¯æ•°æ®: ...
ğŸ“¤ å‘é€æ¶ˆæ¯åˆ°æ¸²æŸ“è¿›ç¨‹ï¼ˆä»…ç”¨æˆ·æ•°æ®ï¼‰: ...
```

å¦‚æœæ²¡æœ‰è¿™äº›æ—¥å¿—ï¼Œè¯´æ˜ï¼š
- WebSocket è¿æ¥å¤±è´¥
- æ¶ˆæ¯æ ¼å¼ä¸æ­£ç¡®
- æœåŠ¡å™¨æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯

#### 4. æ£€æŸ¥é˜²ç«å¢™

ç¡®ä¿ Windows é˜²ç«å¢™å…è®¸ Electron åº”ç”¨è®¿é—®ç½‘ç»œã€‚

#### 5. æ£€æŸ¥ç«¯å£å ç”¨

å¦‚æœ 8765 ç«¯å£è¢«å ç”¨ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨å°è¯•å…¶ä»–ç«¯å£ï¼ˆ8766-8770ï¼‰ã€‚
æŸ¥çœ‹æ§åˆ¶å°ç¡®è®¤å®é™…ä½¿ç”¨çš„ç«¯å£ã€‚

### å¸¸è§é—®é¢˜

#### é—®é¢˜ 1ï¼špreload.js æ‰¾ä¸åˆ°

**ç—‡çŠ¶**ï¼šæ§åˆ¶å°æ˜¾ç¤º preload è·¯å¾„é”™è¯¯

**è§£å†³**ï¼š
1. ç¡®ä¿ `package.json` çš„ `files` ä¸­åŒ…å« `preload.js`
2. æ£€æŸ¥æ‰“åŒ…åçš„ç›®å½•ç»“æ„
3. å¦‚æœä½¿ç”¨ asarï¼Œéœ€è¦é…ç½® `asarUnpack`

#### é—®é¢˜ 2ï¼šWebSocket æœåŠ¡å™¨æœªå¯åŠ¨

**ç—‡çŠ¶**ï¼šæµè§ˆå™¨è¿æ¥å¤±è´¥

**è§£å†³**ï¼š
1. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

#### é—®é¢˜ 3ï¼šæ¶ˆæ¯å‘é€ä½†çª—å£æ²¡ååº”

**ç—‡çŠ¶**ï¼šElectron æ§åˆ¶å°æ˜¾ç¤ºæ”¶åˆ°æ¶ˆæ¯ï¼Œä½†çª—å£ä¸æ˜¾ç¤º

**è§£å†³**ï¼š
1. æ£€æŸ¥ `mainWindow` æ˜¯å¦å­˜åœ¨ä¸”æœªé”€æ¯
2. æ£€æŸ¥ IPC é€šä¿¡æ˜¯å¦æ­£å¸¸
3. æ£€æŸ¥ test-page.html æ˜¯å¦æ­£ç¡®åŠ è½½

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

åœ¨ `electron-main.js` ä¸­å·²ç»æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼ŒæŸ¥çœ‹æ§åˆ¶å°å³å¯ã€‚

#### 2. æµ‹è¯• WebSocket è¿æ¥

åœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼š
```javascript
const ws = new WebSocket('ws://127.0.0.1:8765/ws')
ws.onopen = () => console.log('è¿æ¥æˆåŠŸ')
ws.onmessage = (e) => console.log('æ”¶åˆ°æ¶ˆæ¯:', e.data)
ws.onerror = (e) => console.error('é”™è¯¯:', e)
ws.send(JSON.stringify({ type: 'ping' }))
```

#### 3. æ£€æŸ¥ IPC é€šä¿¡

åœ¨ test-page.html çš„æ§åˆ¶å°åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… Electron API å·²åŠ è½½
ğŸ“¨ æ”¶åˆ°ä¸»è¿›ç¨‹æ¶ˆæ¯: ...
```

å¦‚æœæ²¡æœ‰ï¼Œè¯´æ˜ preload.js æ²¡æœ‰æ­£ç¡®åŠ è½½ã€‚

### æ‰“åŒ…é…ç½®æ£€æŸ¥æ¸…å•

- [ ] `package.json` çš„ `files` åŒ…å«æ‰€æœ‰å¿…è¦æ–‡ä»¶
- [ ] `preload.js` åœ¨æ‰“åŒ…æ–‡ä»¶ä¸­
- [ ] `test-page.html` åœ¨æ‰“åŒ…æ–‡ä»¶ä¸­
- [ ] `node_modules/ws` å·²æ‰“åŒ…
- [ ] æ²¡æœ‰ä½¿ç”¨ asarï¼ˆæˆ–å·²æ­£ç¡®é…ç½® asarUnpackï¼‰

### é‡æ–°æ‰“åŒ…

å¦‚æœä¿®æ”¹äº†é…ç½®ï¼Œéœ€è¦é‡æ–°æ‰“åŒ…ï¼š

```bash
cd D:\admin\electron-app
npm run build
```

ç„¶åé‡æ–°å®‰è£…å¹¶è¿è¡Œæ‰“åŒ…åçš„åº”ç”¨ã€‚

